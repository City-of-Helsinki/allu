<form [formGroup]="form">
    <mat-card>
        <mat-card-title>
            {{'chargeBasis.title' | translation}}
            <button mat-icon-button (click)="newEntry()" class="align-with-text"><mat-icon>add</mat-icon></button>
        </mat-card-title>
        <mat-card-content>
            <div formArrayName="chargeBasisEntries">
                <ul>
                    <li *ngFor="let entry of chargeBasisEntries.controls; let i=index;">
                        <mat-card class="slim-card">
                            <mat-card-content>
                                <div fxLayout="row" fxLayout.sm="column" fxLayoutWrap>
                                    <div fxFlex="90px">
                                        <ng-container *ngIf="entry.value.manuallySet">
                                            <button mat-icon-button (click)="editEntry(i)"><mat-icon>edit</mat-icon></button>
                                            <button mat-icon-button (click)="removeEntry(i)"><mat-icon>clear</mat-icon></button>
                                        </ng-container>
                                    </div>
                                    <div fxFlex="30" class="row-header">{{entry.value.text}}</div>
                                    <div fxFlex ="60" *ngIf="entry.value.unit==='PERCENT'; else normalEntry">
                                        <div fxFlex="66"></div>
                                        <div fxFlex="33" class="row-field-highlight">{{entry.value.quantity}} %</div>
                                    </div>
                                    <ng-template #normalEntry>
                                        <div fxFlex="20">{{entry.value.quantity}} {{['chargeBasis.unit', entry.value.unit] | translation}}</div>
                                        <div fxFlex="20">à {{entry.value.unitPrice}} €</div>
                                        <div fxFlex="20" class="row-field-highlight">{{entry.getRawValue().netPrice}} €</div>
                                    </ng-template>
                                    <div fxFlex="90" fxFlexOffset="90px">
                                        <span *ngFor="let explanationEntry of entry.value.explanation; let last=last;">
                                            {{explanationEntry | commaSeparated:last}}
                                        </span>
                                    </div>
                                </div>
                            </mat-card-content>
                        </mat-card>
                    </li>
                </ul>
            </div>
        </mat-card-content>
    </mat-card>
</form>
