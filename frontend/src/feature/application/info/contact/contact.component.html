<div [formGroup]="contactsForm">
    <div formArrayName="contacts">
        <div *ngFor="let contact of contacts.controls; let index=index" class="col m6 loose contact-card">
            <div [formGroupName]="index" class="no-border">
                <md-card>
                    <md-card-title>
                        {{headerText}}
                        <button md-icon-button type="button"
                                *ngIf="canBeEdited(contact.value)"
                                (click)="edit(contact.value.id, index)">
                            <md-icon>mode_edit</md-icon>
                        </button>
                        <button md-icon-button type="button"
                                *ngIf="canBeRemoved()"
                                (click)="remove(index)">
                            <md-icon>clear</md-icon>
                        </button>
                    </md-card-title>
                    <md-card-content>
                        <div class="row form-group">
                            <div class="col m6">
                                <md-input-container class="input-full-width">
                                    <input mdInput type="text" formControlName="name"
                                           placeholder="Yhteyshenkilön nimi*"
                                           [mdAutocomplete]="nameSearch" (keyup)="resetContactIfExisting(index)"/>
                                    <md-autocomplete #nameSearch="mdAutocomplete">
                                        <md-option *ngFor="let contact of matchingContacts | async"
                                                   [value]="contact.name" (click)="contactSelected(contact, index)">
                                            {{ contact.name }}
                                        </md-option>
                                    </md-autocomplete>
                                    <md-hint>
                                        <field-error [form]="contact" field="name" hasError="required">{{'contact.field.nameMissing' | translation}}</field-error>
                                    </md-hint>
                                </md-input-container>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col m6">
                                <md-input-container class="input-full-width">
                                    <input mdInput type="text" formControlName="streetAddress" placeholder="Katuosoite"/>
                                </md-input-container>
                            </div>
                            <div class="col m3">
                                <md-input-container class="input-full-width">
                                    <input mdInput type="text" formControlName="postalCode" placeholder="Postinumero"/>
                                    <md-hint>
                                        <field-error [form]="contact" field="postalCode" hasError="pattern">{{'common.field.postalCode' | translation}}</field-error>
                                    </md-hint>
                                </md-input-container>
                            </div>
                            <div class="col m3">
                                <md-input-container class="input-full-width">
                                    <input mdInput type="text" formControlName="city" placeholder="Toimipaikka"/>
                                </md-input-container>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col m4">
                                <md-input-container class="input-full-width">
                                    <input mdInput type="text" formControlName="phone" placeholder="Puhelin"/>
                                    <md-hint>
                                        <field-error [form]="contact" field="phone" hasError="minlength">{{'contact.field.phoneShort' | translation}}</field-error>
                                    </md-hint>
                                </md-input-container>
                            </div>
                            <div class="col m8">
                                <md-input-container class="input-full-width">
                                    <input mdInput type="text" formControlName="email" placeholder="Sähköpostiosoite"/>
                                    <md-hint>
                                        <field-error [form]="contact" field="email" hasError="pattern">{{'common.field.emailInvalid' | translation}}</field-error>
                                    </md-hint>
                                </md-input-container>
                            </div>
                        </div>
                        <div *ngIf="!readonly" class="row form-group">
                            <div class="col m12">
                                <button *ngIf="addNew" md-raised-button type="button" color="primary"
                                        (click)="addContact()">UUSI YHTEYSHENKILÖ</button>
                            </div>
                        </div>
                    </md-card-content>
                </md-card>
            </div>
        </div>
    </div>
</div>