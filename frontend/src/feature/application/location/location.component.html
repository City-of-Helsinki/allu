<progressbar [step]="progressStep" [application]="application"></progressbar>
<application-type (onTypeChange)="onApplicationTypeChange($event)"
                  (onKindSpecifierChange)="onKindSpecifierChange($event)"></application-type>

<form [formGroup]="locationForm" (ngSubmit)="onSubmit(locationForm.value)" [hidden]="!kindsSelected">
  <div class="row">
    <div class="col m12">
      <md-card>
        <md-card-title>Sijainti</md-card-title>
        <md-card-content>
          <div class="row">
            <div class="mapcontainer">
              <div class="map-overlay">
                <searchbar [datesRequired]="true">Loading searchbar</searchbar>
              </div>
              <map [zoom]="true" [draw]="true" [edit]="true" [selection]="true"
                   [applicationId]="application.id" (editedItemCountChanged)="editedItemCountChanged($event)"></map>
            </div>
          </div>
          <div class="row form-group">
            <ng-container *ngIf="areas.length > 0">
              <div *ngIf="editedItemCount > 0" class="col m6">
                <div class="input-field-info-text">
                  Kiinteää aluetta ei voi valita, mikäli kartalle on piirretty
                </div>
              </div>
              <div class="col m6" *ngIf="editedItemCount === 0">
                <md-select placeholder="Alue" class="input-full-width" formControlName="area">
                  <md-option value="" selected>Ei tapahtuma-aluetta</md-option>
                  <md-option *ngFor="let area of areas" [value]="area.id">{{area.name}}</md-option>
                </md-select>
              </div>
              <div class="col m2">
                <div *ngIf="areaSections.length">
                  <md-select formControlName="sections" class="input-full-width" multiple placeholder="Lohko">
                    <md-option *ngFor="let section of areaSections" [value]="section.id">{{section.name}}</md-option>
                  </md-select>
                </div>
              </div>
            </ng-container>
          </div>
          <div class="row form-group">
            <div class="col m2">
              <md-form-field class="input-full-width">
                <input mdInput type="number" formControlName="areaSize" placeholder="Alueen pinta-ala"/>
              </md-form-field>
            </div>
            <div class="col m2">
              <md-form-field class="input-full-width">
                <input mdInput type="number" formControlName="areaOverride" placeholder="Käsittelijän syöttämä pinta-ala"/>
              </md-form-field>
            </div>
            <div class="col m2">
              <md-form-field class="input-full-width">
                <input mdInput type="text" formControlName="cityDistrictName" placeholder="Kaupunginosa"/>
              </md-form-field>
            </div>
            <div class="col m2">
              <md-select formControlName="cityDistrictIdOverride" class="input-full-width" placeholder="Käsittelijän valitsema kaupunginosa">
                <md-option value="" selected>-</md-option>
                <md-option *ngFor="let district of districts | async" [value]="district.id">{{district.name}}</md-option>
              </md-select>
            </div>
            <div class="col m2" *ngIf="application.type==='AREA_RENTAL'">
              <md-checkbox formControlName="underpass" class="checkbox-matching-height">
                Altakuljettava
              </md-checkbox>
            </div>
          </div>
          <div class="row" form-group>
            <div class="col m10">
              <md-form-field class="input-full-width">
                <input mdInput type="text" formControlName="info" placeholder="Lisätietoja paikasta"/>
              </md-form-field>
            </div>
          </div>
          <div class="row" form-group>
            <div class="col m12" *ngIf="multipleLocations">
              <button md-raised-button type="button" color="primary" [disabled]="!locationForm.valid" (click)="store(locationForm.value)">TALLENNA</button>
              <button md-raised-button type="button" color="primary" (click)="cancel()">PERUUTA</button>
            </div>
          </div>
          <div class="row" *ngIf="multipleLocations">
            <div class="col m12">
              <stored-locations></stored-locations>
            </div>
          </div>
        </md-card-content>
      </md-card>
    </div>
  </div>
  <div class="row">
    <div class="col m12">
      <md-card>
        <md-card-title>Tallennus</md-card-title>
        <md-card-content>
          <div class="row">
            <div class="col m2">
              <a md-raised-button type="button" color="primary" [routerLink]="['/home']">PERUUTA</a>
            </div>
            <div class="col m4 offset-m6">
              <button md-raised-button type="submit" color="primary" [disabled]="!submitAllowed">{{id ? "YHTEENVETOON" : "PERUSTIEDOT"}}</button>
            </div>
          </div>
        </md-card-content>
      </md-card>
    </div>
  </div>
</form>
