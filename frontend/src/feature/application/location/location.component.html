<progressbar [step]="progressStep" [application]="application"></progressbar>
<application-type (onTypeChange)="onApplicationTypeChange($event)"
                  (onKindChange)="onApplicationKindChange($event)"
                  (onSpecifierChange)="onApplicationSpecifierChange($event)"></application-type>
<form [formGroup]="locationForm" (ngSubmit)="onSubmit(locationForm.value)" [hidden]="!typeSelected">
  <div class="row">
    <div class="col m12">
      <md-card>
        <md-card-title>Sijainti</md-card-title>
        <md-card-content>
          <div class="row">
            <div class="mapcontainer">
              <div class="map-overlay">
                <searchbar [filter]="searchbarFilter" [datesRequired]="true"
                           (searchUpdated)="searchUpdated($event)">Loading searchbar</searchbar>
              </div>
              <map [zoom]="true" [draw]="true" [edit]="editingAllowed" [selection]="true"
                   [applicationId]="application.id" (editedItemCountChanged)="editedItemCountChanged($event)"></map>
            </div>
          </div>
          <div class="row">
            <div *ngIf="areas.length > 0">
              <div *ngIf="editedItemCount > 0" class="col m10">
                <div class="input-field-info-text">
                  Kiinteää aluetta ei voi valita, mikäli kartalle on piirretty
                </div>
              </div>
              <div *ngIf="editedItemCount === 0">
                <div class="col m6">
                  <md-select placeholder="Alue" class="input-full-width" formControlName="area">
                    <md-option value="" selected>Ei tapahtuma-aluetta</md-option>
                    <md-option *ngFor="let area of areas" [value]="area.id">{{area.name}}</md-option>
                  </md-select>
                </div>
                <div class="col m2">
                  <div *ngIf="sections.length > 0">
                    <md-select formControlName="sections" [multiple]="true" placeholder="Lohko">
                      <option *ngFor="let section of sections" [value]="section.id">{{section.name}}</option>
                    </md-select>
                  </div>
                </div>
              </div>
            </div>
            <div class="col m2">
              <md-input-container class="input-full-width">
                <input mdInput type="number" formControlName="areaSize" placeholder="Alueen pinta-ala"/>
              </md-input-container>
            </div>
            <div class="col m2">
              <md-input-container class="input-full-width">
                <input mdInput type="number" formControlName="areaOverride" placeholder="Käsittelijän syöttämä pinta-ala"/>
              </md-input-container>
            </div>
            <div class="col m2">
              <md-input-container class="input-full-width">
                <input mdInput type="text" formControlName="cityDistrictName" placeholder="Kaupunginosa"/>
              </md-input-container>
            </div>
            <div class="col m2">
              <md-select formControlName="cityDistrictIdOverride" class="input-full-width" placeholder="Käsittelijän valitsema kaupunginosa">
                <md-option value="" selected>-</md-option>
                <md-option *ngFor="let district of districts | async" [value]="district.id">{{district.name}}</md-option>
              </md-select>
            </div>
            <div class="col m8">
              <md-input-container class="input-full-width">
                <input mdInput type="text" formControlName="info" placeholder="Lisätietoja paikasta"/>
              </md-input-container>
            </div>
            <div class="col m12" *ngIf="multipleLocations">
              <button md-raised-button type="button" color="primary" [disabled]="!locationForm.valid" (click)="store(locationForm.value)">TALLENNA</button>
              <button md-raised-button type="button" color="primary" (click)="cancel()">PERUUTA</button>
            </div>
          </div>
          <div class="row" *ngIf="multipleLocations">
            <div class="col m12">
              <stored-locations></stored-locations>
            </div>
          </div>
        </md-card-content>
      </md-card>
    </div>
  </div>
  <div class="row">
    <div class="col m12">
      <md-card>
        <md-card-title>Tallennus</md-card-title>
        <md-card-content>
          <div class="row">
            <div class="col m2">
              <a md-raised-button type="button" color="primary" [routerLink]="['/home']">PERUUTA</a>
            </div>
            <div class="col m4 offset-m6">
              <button md-raised-button type="submit" color="primary" [disabled]="!submitAllowed">{{id ? "YHTEENVETOON" : "PERUSTIEDOT"}}</button>
            </div>
          </div>
        </md-card-content>
      </md-card>
    </div>
  </div>
</form>
