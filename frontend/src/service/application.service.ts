import { Injectable } from '@angular/core';
import {AuthHttp} from 'angular2-jwt/angular2-jwt';
import {Application} from '../model/application/application';
import {Area} from '../model/location/area';
import {Customer} from '../model/customer/customer';

@Injectable()
export class ApplicationService {

  private applications: Array<Application> = [];

  constructor(private authHttp: AuthHttp) {
    this.applications = this.createMockApplications();
  }

  public listApplications(): Array<Application> {
    // this.applications = this.createMockApplications();

    // this.authHttp.get('/api/applications').subscribe(
    //   data => this.addBackendApplication(this.applications, data),
    //   err => console.log(err),
    //   () => console.log('Request Complete')
    // );
    // console.log('Listing applications', this.applications);
    return this.applications;
  }

  public addApplication(application: Application): Promise<Application> {

    return new Promise<Application>((resolve, reject) =>
      this.authHttp.post('/api/applications',
        JSON.stringify({ 'applicationList': [{ 'name': 'namez', 'type': 'typez',
          'customer': { 'name': 'custo'} }]}))
        .subscribe(
          data => {Â let appl = this.mapBackendApplication(data); console.log('Created application', appl); resolve(appl); },
          err => reject(err),
          () => console.log('Request Complete')
        )
    );
  }


  private mapBackendApplication(anyApp: any): Application {
    let appJson = anyApp.json();
    console.log('anyApp.id', appJson);
    let app = appJson.applicationList[0];
    let customer = new Customer(app.customer.name);
    let newApplication = new Application(app.id, 'undefined title', app.name, app.type,
      'undefined time', 60.179884, 24.930865, undefined, customer);
    console.log('Adding new application to list', newApplication);
    return newApplication;
  }

  private createMockApplications(): Array<Application> {
    return [
      new Application(
        12345,
        'Vincit Picnic',
        'Sadi Hossain / Vincit Helsinki Oy',
        'Promootio',
        '24.04.2016 - 05.05.2016',
        60.158045,
        24.954339,
        new Area('polygon', [
          {lat: 60.158910597964926, lng: 24.955063462257385},
          {lat: 60.1588678889173, lng: 24.95495080947876},
          {lat: 60.15598756944988, lng: 24.950857758522034},
          {lat: 60.15581938729864, lng: 24.950782656669617},
          {lat: 60.15559247350877, lng: 24.951007962226868},
          {lat: 60.15417489425848, lng: 24.9554443359375},
          {lat: 60.15408946380081, lng: 24.955632090568542},
          {lat: 60.15404140907081, lng: 24.9558413028717},
          {lat: 60.153971996559, lng: 24.956050515174866},
          {lat: 60.15391860221945, lng: 24.956871271133423},
          {lat: 60.15395597826625, lng: 24.95695173740387},
          {lat: 60.15399602398352, lng: 24.95720386505127},
          {lat: 60.15398801484397, lng: 24.957354068756104},
          {lat: 60.15410548202853, lng: 24.9577134847641},
          {lat: 60.154268333567344, lng: 24.95795488357544},
          {lat: 60.154508604856375, lng: 24.95823383331299},
          {lat: 60.15473819578068, lng: 24.95843231678009},
          {lat: 60.15478091019434, lng: 24.958464503288265},
          {lat: 60.154938419115034, lng: 24.95863080024719},
          {lat: 60.15496778510152, lng: 24.95863080024719},
          {lat: 60.15500782958629, lng: 24.95867371559143},
          {lat: 60.155074570285834, lng: 24.958829283714294},
          {lat: 60.15516266780173, lng: 24.958759546279907},
          {lat: 60.15524008663598, lng: 24.958721995353695},
          {lat: 60.15530415725744, lng: 24.958721995353695},
          {lat: 60.15540026295552, lng: 24.95873272418976},
          {lat: 60.15545899407715, lng: 24.958764910697937},
          {lat: 60.15549636837263, lng: 24.958813190460205},
          {lat: 60.15554175138859, lng: 24.958990216255188},
          {lat: 60.15554175138859, lng: 24.959059953689575},
          {lat: 60.15553374262562, lng: 24.959140419960022},
          {lat: 60.15551505550442, lng: 24.959236979484558},
          {lat: 60.15547768123019, lng: 24.959365725517273},
          {lat: 60.155370897355375, lng: 24.959580302238464},
          {lat: 60.155338862125284, lng: 24.959987998008728},
          {lat: 60.155467002858316, lng: 24.960889220237732},
          {lat: 60.15561916933004, lng: 24.961565136909485},
          {lat: 60.155795361206806, lng: 24.961774349212646},
          {lat: 60.15603295178769, lng: 24.961806535720825},
          {lat: 60.15612371627538, lng: 24.961779713630676},
          {lat: 60.15621448051247, lng: 24.96169924736023},
          {lat: 60.15635062639818, lng: 24.961538314819336},
          {lat: 60.156478763187295, lng: 24.961280822753906},
          {lat: 60.15601960404777, lng: 24.961039423942566},
          {lat: 60.15577667423435, lng: 24.959880709648132},
          {lat: 60.15578468293811, lng: 24.959703683853146},
          {lat: 60.15584608293567, lng: 24.959338903427124},
          {lat: 60.15625452347856, lng: 24.95890438556671},
          {lat: 60.15638533016122, lng: 24.958850741386414},
          {lat: 60.15651613632337, lng: 24.958872199058533},
          {lat: 60.156596221471844, lng: 24.95892584323883},
          {lat: 60.15665495045673, lng: 24.958861470222473},
          {lat: 60.15664160296938, lng: 24.958791732788086},
          {lat: 60.15665495045673, lng: 24.958625435829163},
          {lat: 60.156692323392484, lng: 24.95848059654236},
          {lat: 60.15678575554596, lng: 24.958319664001465},
          {lat: 60.15699664428761, lng: 24.95819091796875},
          {lat: 60.15741841771193, lng: 24.95815873146057},
          {lat: 60.157936284008144, lng: 24.957852959632874},
          {lat: 60.1581444959925, lng: 24.958325028419495},
          {lat: 60.15827796451952, lng: 24.958003163337708},
          {lat: 60.158008357536595, lng: 24.95732188224792},
          {lat: 60.15801369631019, lng: 24.957278966903687},
          {lat: 60.158526214538284, lng: 24.956554770469666},
          {lat: 60.15851553715671, lng: 24.956527948379517},
          {lat: 60.158635657499424, lng: 24.956136345863342},
          {lat: 60.15868904417753, lng: 24.956071972846985},
          {lat: 60.158582270734655, lng: 24.955637454986572},
          {lat: 60.159009362425046, lng: 24.95516538619995}])),
      new Application(
        54321,
        'Team building seminar',
        'Jan Nikander / Vincit Helsinki Oy',
        'Alustava hakemus',
        '04.05.2016 - 08.05.2016',
        60.171048,
        24.943997,
        new Area('circle', [{lat: 60.17125385566991, lng: 24.94398593902588}], 30.035828895335158)),
      new Application(
        11111,
        'Vincit Run Helsinki',
        'Perttu Taskinen / Vincit Helsinki Oy',
        'Banneri',
        '01.05.2016 - 01.05.2016',
        60.179884,
        24.930865,
        new Area('polyline', [
          {lat: 60.18017547681174, lng: 24.931111335754395},
          {lat: 60.18107177367166, lng: 24.931089878082272},
          {lat: 60.18118914406802, lng: 24.931132793426514},
          {lat: 60.18236282495935, lng: 24.93166923522949},
          {lat: 60.182650903857066, lng: 24.93173360824585},
          {lat: 60.18286429400376, lng: 24.931604862213135},
          {lat: 60.182928310777335, lng: 24.93173360824585},
          {lat: 60.184080591360406, lng: 24.93218421936035},
          {lat: 60.18448601380063, lng: 24.93244171142578},
          {lat: 60.18457136525544, lng: 24.932613372802734},
          {lat: 60.184678054261965, lng: 24.933300018310547},
          {lat: 60.18488076241924, lng: 24.934716224670407},
          {lat: 60.18482741828866, lng: 24.935102462768555},
          {lat: 60.1846673853769, lng: 24.935402870178223},
          {lat: 60.1844326690287, lng: 24.93574619293213},
          {lat: 60.184197951002645, lng: 24.93596076965332},
          {lat: 60.18400590773329, lng: 24.936025142669674},
          {lat: 60.18380319417484, lng: 24.936153888702393},
          {lat: 60.1833977633035, lng: 24.936089515686035},
          {lat: 60.18303500512264, lng: 24.936282634735107},
          {lat: 60.18268291246746, lng: 24.93647575378418},
          {lat: 60.18241617309406, lng: 24.936776161193848},
          {lat: 60.18221344972111, lng: 24.937162399291992},
          {lat: 60.18201072509663, lng: 24.936926364898678},
          {lat: 60.181818669034776, lng: 24.9369478225708},
          {lat: 60.18156259253829, lng: 24.937076568603516},
          {lat: 60.18133852396577, lng: 24.937162399291992},
          {lat: 60.18105043355454, lng: 24.937291145324707},
          {lat: 60.18082636148732, lng: 24.93769884109497},
          {lat: 60.180527596352725, lng: 24.93769884109497},
          {lat: 60.18032486132055, lng: 24.93793487548828},
          {lat: 60.17995139877439, lng: 24.938170909881592},
          {lat: 60.17951390867583, lng: 24.938299655914307},
          {lat: 60.17917244893965, lng: 24.93823528289795},
          {lat: 60.17897237322591, lng: 24.938133358955383},
          {lat: 60.17854820868162, lng: 24.93746817111969},
          {lat: 60.177627832812014, lng: 24.936094880104065},
          {lat: 60.17745442577516, lng: 24.935842752456665},
          {lat: 60.177355716745296, lng: 24.93561208248138},
          {lat: 60.177302360389405, lng: 24.935402870178223},
          {lat: 60.177254339594974, lng: 24.93517756462097},
          {lat: 60.17720365090248, lng: 24.935107827186584},
          {lat: 60.17703557730974, lng: 24.93474304676056},
          {lat: 60.17698222043376, lng: 24.934276342391968},
          {lat: 60.176979552587675, lng: 24.934169054031372},
          {lat: 60.17702223809887, lng: 24.93395447731018},
          {lat: 60.177038245151266, lng: 24.933412671089172},
          {lat: 60.17712094813099, lng: 24.932774305343628},
          {lat: 60.17717697261184, lng: 24.9325168132782},
          {lat: 60.177321035123825, lng: 24.932141304016113},
          {lat: 60.17752645650164, lng: 24.931615591049194},
          {lat: 60.177686524217094, lng: 24.93134200572967},
          {lat: 60.17825209056391, lng: 24.93097722530365},
          {lat: 60.178510860597676, lng: 24.930837750434875},
          {lat: 60.17861490158297, lng: 24.930805563926697},
          {lat: 60.17874561927682, lng: 24.930821657180786},
          {lat: 60.17926848484928, lng: 24.931025505065918},
          {lat: 60.17966863144996, lng: 24.931073784828186},
          {lat: 60.17990871707011, lng: 24.931089878082272},
          {lat: 60.180164806463665, lng: 24.931111335754395}
        ]))
    ];

  }
}
