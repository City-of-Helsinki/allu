<div class="main-content">
  <div class="search-bar">
    <h1>HAKU</h1>
    <form [formGroup]="queryForm">
      <div class="row">
        <div class="col m4 s6">
          <mat-form-field class="input-full-width">
            <input matInput type="text" formControlName="applicationId" placeholder="Hakemuksen tunnus"/>
          </mat-form-field>
        </div>
        <div class="col m2 s6">
          <mat-form-field class="input-full-width">
            <mat-select formControlName="type" [multiple]="true" placeholder="Hakemuksen tyyppi" class="input-full-width">
              <mat-option *ngFor="let option of applicationTypeStrings" [value]="option">
                {{ ['application.type', option] | translation }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col m2 s6">
          <mat-form-field class="input-full-width">
            <mat-select formControlName="status" [multiple]="true" placeholder="Hakemuksen tila" class="input-full-width">
              <mat-option *ngFor="let option of applicationStatusStrings" [value]="option">
                {{ ['application.status', option] | translation }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col m2 s6">
          <mat-form-field class="input-full-width">
            <mat-select formControlName="districts" [multiple]="true" placeholder="Kaupunginosa" class="input-full-width">
              <mat-option *ngFor="let district of districts | async" [value]="district.id">{{district.name}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col m2 s6">
          <mat-form-field class="input-full-width">
            <mat-select formControlName="handler" [multiple]="true" placeholder="Hakemuksen käsittelijä" class="input-full-width">
              <mat-option *ngFor="let handler of handlers | async" [value]="handler.userName">{{handler.realName}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col m4 s6">
          <mat-form-field class="input-full-width">
            <input matInput type="text" formControlName="address" placeholder="Osoite"/>
          </mat-form-field>
        </div>
        <div class="col m2 s6">
          <mat-form-field class="input-full-width">
            <input matInput type="text" formControlName="applicant" placeholder="Hakija"/>
          </mat-form-field>
        </div>
        <div class="col m2 s6">
          <mat-form-field class="input-full-width">
            <input matInput type="text" formControlName="contact" placeholder="Yhteyshenkilö"/>
          </mat-form-field>
        </div>
        <div class="col m2 s6">
          <mat-form-field class="input-full-width">
            <input matInput type="text" formControlName="freeText" placeholder="Vapaa tekstihaku"/>
          </mat-form-field>
        </div>
        <div class="col m1 s6">
          <mat-form-field class="input-full-width">
            <input matInput type="text" formControlName="startTime" placeholder="Alkupäivämäärä"
                   [matDatepicker]="startTimePicker"/>
            <mat-datepicker-toggle matSuffix [for]="startTimePicker"></mat-datepicker-toggle>
            <mat-datepicker #startTimePicker></mat-datepicker>
          </mat-form-field>
        </div>
        <div class="col m1 s6">
          <mat-form-field class="input-full-width">
            <input matInput type="text" formControlName="endTime" placeholder="Loppupäivämäärä"
                   [matDatepicker]="endTimePicker"/>
            <mat-datepicker-toggle matSuffix [for]="endTimePicker"></mat-datepicker-toggle>
            <mat-datepicker #endTimePicker></mat-datepicker>
          </mat-form-field>
        </div>
        <div class="col m12 s12">
          <button (click)="search()" mat-raised-button type="button" color="primary">HAE</button>
        </div>
      </div>
    </form>
  </div>

  <div class="row">
    <div class=" col s12">
      <table class="bordered responsive-table">
        <thead>
        <tr>
          <th sortBy="handler.userName" [currentSort]="sort" (onSortChange)="sortBy($event)">Käsittelijä</th>
          <th sortBy="name" [currentSort]="sort" (onSortChange)="sortBy($event)">Nimi</th>
          <th sortBy="type" [currentSort]="sort" (onSortChange)="sortBy($event)">Tyyppi</th>
          <th sortBy="status" [currentSort]="sort" (onSortChange)="sortBy($event)">Tila</th>
          <th>Hanke</th>
          <th sortBy="customers.applicant.customer.name" [currentSort]="sort" (onSortChange)="sortBy($event)">Hakija</th>
          <th sortBy="locations.streetAddress" [currentSort]="sort" (onSortChange)="sortBy($event)">Katuosoite</th>
          <th sortBy="locations.cityDistrictId" [currentSort]="sort" (onSortChange)="sortBy($event)">Kaupunginosa</th>
          <th>Saapunut</th>
          <th sortBy="startTime" [currentSort]="sort" (onSortChange)="sortBy($event)">Aloitus</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let application of applications" class="clickable row-highlight"
            (click)="goToSummary(application)">
          <td>{{application.handler?.realName}}</td>
          <td>{{application.name}}</td>
          <td>{{ ['application.type', application.type] | translation }}</td>
          <td>{{ ['application.status', application.status] | translation }}</td>
          <td>
            {{application.project?.name}} <br>
            <span>{{application.project?.id}}</span>
          </td>
          <td>{{application.applicant.customer.name}}</td>
          <td>{{application.firstLocation.postalAddress.streetAddress}}</td>
          <td>{{districtName(application.firstLocation.effectiveCityDistrictId) | async}}</td>
          <td>{{application.uiApplicationCreationTime}}</td>
          <td>{{application.uiStartTime}}</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
